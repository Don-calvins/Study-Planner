<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Planner Web App - Fixed</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; }
        input, textarea, button { width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background: #45a049; }
        #status { color: #666; margin: 10px 0; font-style: italic; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        .loading { color: #007bff; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <h1>ðŸ§  AI Study Planner</h1>
    <p>Upload text/PDF or paste syllabus content for instant AI-generated schedule</p>
    
    <input type="file" id="fileInput" accept=".txt,.pdf,.docx" />
    <textarea id="content" placeholder="Or paste your document/syllabus text here..." rows="8"></textarea>
    <button onclick="generatePlan()">âœ¨ Generate AI Study Plan</button>
    <div id="status"></div>
    <div id="planOutput"></div>

    <script>
        const statusEl = document.getElementById('status');
        const fileInput = document.getElementById('fileInput');
        const contentEl = document.getElementById('content');
        const outputEl = document.getElementById('planOutput');
        
        // File upload handler - FIXED
        fileInput.addEventListener('change', async function(e) {
            statusEl.textContent = 'Reading file...';
            statusEl.className = 'loading';
            
            const file = e.target.files[0];
            if (!file) return;
            
            try {
                if (file.name.endsWith('.txt')) {
                    const text = await readFileAsText(file);
                    contentEl.value = text;
                    await generatePlan();
                } else if (file.name.endsWith('.pdf')) {
                    statusEl.textContent = 'PDF detected - basic text extraction (upgrade for full OCR)';
                    // Simple PDF fallback - show filename as topics
                    const topics = [`ðŸ“š ${file.name.split('.')[0]} - Ch1`, `ðŸ“š ${file.name.split('.')[0]} - Ch2`, 'Review'];
                    showPlan(createSimplePlan(topics));
                }
            } catch (err) {
                statusEl.textContent = 'Error reading file: ' + err.message;
                statusEl.className = 'error';
            }
        });
        
        async function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = () => reject(new Error('Failed to read file'));
                reader.readAsText(file);
            });
        }
        
        async function generatePlan() {
            statusEl.textContent = 'Generating AI plan...';
            statusEl.className = 'loading';
            
            try {
                const text = contentEl.value.trim();
                if (!text) {
                    statusEl.textContent = 'Please paste content or upload a file first';
                    return;
                }
                
                const topics = extractTopics(text);
                const plan = createOptimizedPlan(topics);
                showPlan(plan);
                statusEl.textContent = `âœ… Plan generated! Found ${topics.length} topics.`;
                statusEl.className = '';
            } catch (err) {
                statusEl.textContent = 'Error: ' + err.message;
                statusEl.className = 'error';
            }
        }
        
        function extractTopics(text) {
            const topics = new Set();
            const lines = text.toLowerCase().split('\n');
            
            // Smart topic detection
            lines.forEach(line => {
                if (line.match(/(chapter|ch\.?|topic|unit|module|lesson)[\s\w.-]+/i)) {
                    const match = line.match(/(chapter|ch\.?|topic|unit|module|lesson)[\s\w.-]{1,25}/i);
                    topics.add(match[0]);
                }
                if (line.match(/(exam|test|quiz|due|deadline)[\s\w.-]+/i)) {
                    topics.add(line.match(/(exam|test|quiz|due|deadline)\s+[\w\s-]{1,20}/i)[0]);
                }
                if (line.match(/math|science|history|english|biology|physics|chemistry/i)) {
                    topics.add(line.match(/math|science|history|english|biology|physics|chemistry/i)[0]);
                }
            });
            
            return Array.from(topics).slice(0, 10) || 
                   ['Algebra Basics', 'Physics Mechanics', 'History Overview', 'English Literature'];
        }
        
        function createOptimizedPlan(topics) {
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const plan = { headers: ['Time', ...days, 'Sun'], rows: [] };
            const slots = ['7-9 AM (Focus)', '4-6 PM (Practice)', '8-9 PM (Review)'];
            
            let topicIndex = 0;
            slots.forEach(slot => {
                const row = { time: slot, tasks: {} };
                days.forEach(day => {
                    row.tasks[day] = topics[topicIndex % topics.length] || 'Rest';
                    topicIndex++;
                });
                row.tasks['Sun'] = 'ðŸ“Š Weekly Review';
                plan.rows.push(row);
            });
            return plan;
        }
        
        function createSimplePlan(topics) {
            return createOptimizedPlan(topics);
        }
        
        function showPlan(plan) {
            let html = '<h3>ðŸ“… Your Weekly Study Plan</h3>';
            html += '<table><tr><th>' + plan.headers.join('</th><th>') + '</th></tr>';
            plan.rows.forEach(row => {
                html += '<tr><td>' + row.time + '</td>';
                plan.headers.slice(1).forEach(day => {
                    html += '<td>' + (row.tasks[day] || 'Break') + '</td>';
                });
                html += '</tr>';
            });
            html += '</table>';
            outputEl.innerHTML = html;
        }
        
        // Auto-generate on Enter in textarea
        contentEl.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) generatePlan();
        });
    </script>
</body>
</html>
